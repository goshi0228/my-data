<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å²©æ‰‹çœŒè‡ªæ²»ä½“ãƒ‡ãƒ¼ã‚¿æ¯”è¼ƒãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&family=Noto+Sans+JP:wght@400;500;700;900&display=swap');
        
        :root {
            --group-a: #2563eb;
            --group-b: #312e81;
            --bg-main: #f8fafc;
        }

        body { 
            font-family: 'Inter', 'Noto Sans JP', sans-serif; 
            background-color: var(--bg-main);
            color: #1e293b;
            overflow-x: hidden;
        }

        .custom-scrollbar::-webkit-scrollbar { width: 5px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #e2e8f0; border-radius: 10px; }
        .custom-scrollbar::-webkit-scrollbar-thumb:hover { background: #cbd5e1; }

        .shadow-soft {
            box-shadow: 0 4px 20px -2px rgba(0, 0, 0, 0.05);
        }

        .no-scrollbar::-webkit-scrollbar { display: none; }
        .no-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }

        .agg-btn-inactive {
            background-color: transparent !important;
            color: #64748b !important;
        }
        .agg-btn-active {
            background-color: #1e293b !important;
            color: white !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.2);
        }

        .group-tab-active-A {
            background-color: var(--group-a) !important;
            color: white !important;
            box-shadow: 0 4px 12px rgba(37, 99, 235, 0.3);
        }

        .group-tab-active-B {
            background-color: var(--group-b) !important;
            color: white !important;
            box-shadow: 0 4px 12px rgba(49, 46, 129, 0.3);
        }

        .both-selected {
            background: linear-gradient(135deg, var(--group-a) 50%, var(--group-b) 50%) !important;
            color: white !important;
            border: none !important;
        }

        .metric-btn-active {
            transform: translateY(-2px);
            background: white !important;
            border-color: #1e293b !important;
            box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1) !important;
        }
    </style>
</head>
<body class="antialiased">

    <div id="main-content-wrapper">
        <nav class="sticky top-0 z-50 bg-white/80 backdrop-blur-md border-b border-slate-200 shadow-sm">
            <div class="max-w-[1600px] mx-auto px-4 lg:px-8 h-16 flex items-center justify-between">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 bg-slate-900 rounded-xl flex items-center justify-center shadow-lg">
                        <svg xmlns="http://www.w3.org/2000/svg" width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round"><path d="M12 22s-8-4.5-8-11.8A8 8 0 0 1 12 2a8 8 0 0 1 12 2a8 8 0 0 1 8 8.2c0 7.3-8 11.8-8 11.8z"/><circle cx="12" cy="10" r="3"/></svg>
                    </div>
                    <div>
                        <h1 class="text-lg font-black tracking-tight text-slate-800 leading-tight">å²©æ‰‹ãƒ‡ãƒ¼ã‚¿ã‚³ãƒ³ãƒ‘ã‚¹</h1>
                        <p class="text-[10px] text-slate-400 font-bold uppercase tracking-widest mt-0.5 italic">Detailed Municipal Analytics</p>
                    </div>
                </div>
            </div>
        </nav>

        <div class="max-w-[1600px] mx-auto p-4 lg:p-8 flex flex-col gap-8">
            
            <!-- æ¦‚è¦ã‚»ã‚¯ã‚·ãƒ§ãƒ³ -->
            <section class="bg-white rounded-[2.5rem] border border-slate-200 p-6 lg:p-10 shadow-soft overflow-hidden relative">
                <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/5 blur-[80px] -mr-32 -mt-32"></div>
                <div class="relative z-10 flex flex-col md:flex-row gap-12 items-start">
                    <div class="flex-1 space-y-4">
                        <h2 class="text-sm font-black text-blue-600 uppercase tracking-widest flex items-center gap-2">
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
                            ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®æ©Ÿèƒ½
                        </h2>
                        <p class="text-3xl font-black text-slate-800 leading-tight">
                            å²©æ‰‹çœŒå†…å…¨33è‡ªæ²»ä½“ã®<br><span class="text-blue-600 underline underline-offset-8 decoration-blue-100">å…¨åˆ†é‡çµ±è¨ˆ</span>ã‚’è©³ç´°ã«æ¯”è¼ƒã€‚
                        </p>
                        <p class="text-sm text-slate-500 font-medium leading-relaxed max-w-lg">
                            ç¬¬1æ¬¡ç”£æ¥­ã‹ã‚‰å•†å·¥æ¥­ã€æ•™è‚²ã€ãã—ã¦ç¤¾ä¼šå‹•æ…‹ã¾ã§ã€å²©æ‰‹çœŒãŒå…¬é–‹ã™ã‚‹åºƒç¯„ãªãƒ‡ãƒ¼ã‚¿ã‚’ç¶²ç¾…ã—ã¾ã—ãŸã€‚2ã¤ã®ä»»æ„ã‚°ãƒ«ãƒ¼ãƒ—ã‚’é¸æŠã—ã€ãã®æ§‹é€ çš„ãªã€Œå·®ã€ãŒåœ°åŸŸã«ã‚‚ãŸã‚‰ã™æ„å‘³ã‚’åˆ†æã§ãã¾ã™ã€‚
                        </p>
                    </div>
                    <div class="grid grid-cols-1 sm:grid-cols-2 gap-4 flex-[1.5]">
                        <div class="p-5 bg-slate-50 rounded-[1.5rem] border border-slate-100 space-y-3">
                            <div class="w-10 h-10 rounded-2xl bg-blue-100 text-blue-600 flex items-center justify-center font-black text-lg">A/B</div>
                            <h3 class="font-black text-slate-700">ã‚°ãƒ«ãƒ¼ãƒ—æ¯”è¼ƒåˆ†æ</h3>
                            <p class="text-[11px] font-medium text-slate-500 leading-relaxed italic">åœåŸŸã‚„ç‰¹é•·ãŒç•°ãªã‚‹è‡ªæ²»ä½“åŒå£«ã‚’ã¾ã¨ã‚ã€ã‚°ãƒ«ãƒ¼ãƒ—å˜ä½ã§ã®å¼·ã¿ãƒ»å¼±ã¿ã‚’å¯è¦–åŒ–ã—ã¾ã™ã€‚</p>
                        </div>
                        <div class="p-5 bg-slate-50 rounded-[1.5rem] border border-slate-100 space-y-3">
                            <div class="w-10 h-10 rounded-2xl bg-indigo-100 text-indigo-600 flex items-center justify-center font-black text-lg">56</div>
                            <h3 class="font-black text-slate-700">è©³ç´°ãªåˆ†ææŒ‡æ¨™</h3>
                            <p class="text-[11px] font-medium text-slate-500 leading-relaxed italic">è£½é€ å“å‡ºè·é¡ã‹ã‚‰ç”·å¥³åˆ¥è»¢å…¥ã€å­¦æ ¡æ•°ã¾ã§ã€å¤šè§’çš„ãªè¦–ç‚¹ã§åœ°åŸŸã‚’æ‰ãˆç›´ã—ã¾ã™ã€‚</p>
                        </div>
                    </div>
                </div>
            </section>

            <!-- å¸‚ç”ºæ‘é¸æŠ -->
            <section id="selection-area" class="bg-white rounded-[2.5rem] border border-slate-200 p-6 lg:p-8 shadow-soft space-y-6">
                <div class="flex flex-col lg:flex-row lg:items-start justify-between gap-8">
                    <div class="space-y-6 lg:w-[320px] shrink-0 text-center">
                        <div class="flex bg-slate-100 p-1.5 rounded-2xl w-full border border-slate-200 shadow-inner">
                            <button onclick="setEditGroup('A')" id="btn-edit-A" class="flex-1 py-3 rounded-xl text-xs font-black transition-all group-tab-active-A">A ç·¨é›†</button>
                            <button onclick="setEditGroup('B')" id="btn-edit-B" class="flex-1 py-3 rounded-xl text-xs font-black transition-all text-slate-400">B ç·¨é›†</button>
                        </div>
                        <div class="p-5 bg-slate-50 rounded-2xl border border-slate-100 text-left">
                            <div class="flex items-center justify-between mb-4 text-slate-400">
                                <h3 class="text-[10px] font-black uppercase tracking-widest" id="selection-count">A é¸æŠä¸­ (3)</h3>
                                <div class="flex gap-2">
                                    <button onclick="selectAll()" class="text-[10px] font-bold text-blue-600 hover:opacity-70 transition-opacity">å…¨é¸æŠ</button>
                                    <button onclick="deselectAll()" class="text-[10px] font-bold text-slate-400 hover:text-red-500 transition-all">è§£é™¤</button>
                                </div>
                            </div>
                            <div class="grid grid-cols-2 gap-1.5">
                                <button onclick="selectByRegion('çœŒå¤®åºƒåŸŸåœ')" class="px-2 py-2 bg-white border border-slate-200 text-slate-600 rounded-xl text-[9px] font-black hover:bg-slate-900 hover:text-white transition-all text-center">çœŒå¤®åœåŸŸ</button>
                                <button onclick="selectByRegion('çœŒå—åºƒåŸŸåœ')" class="px-2 py-2 bg-white border border-slate-200 text-slate-600 rounded-xl text-[9px] font-black hover:bg-slate-900 hover:text-white transition-all text-center">çœŒå—åœåŸŸ</button>
                                <button onclick="selectByRegion('æ²¿å²¸åºƒåŸŸåœ')" class="px-2 py-2 bg-white border border-slate-200 text-slate-600 rounded-xl text-[9px] font-black hover:bg-slate-900 hover:text-white transition-all text-center">æ²¿å²¸åœåŸŸ</button>
                                <button onclick="selectByRegion('çœŒåŒ—åºƒåŸŸåœ')" class="px-2 py-2 bg-white border border-slate-200 text-slate-600 rounded-xl text-[9px] font-black hover:bg-slate-900 hover:text-white transition-all text-center">çœŒåŒ—åœåŸŸ</button>
                            </div>
                        </div>
                    </div>
                    <div id="city-list-container" class="flex-1 min-w-0">
                        <div id="city-list" class="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-3 lg:grid-cols-4 xl:grid-cols-5 gap-1.5 h-auto"></div>
                        <div class="mt-4 flex gap-4 text-[10px] font-bold text-slate-400 px-2 italic">
                            <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-sm bg-blue-600"></div>Aé¸æŠ</div>
                            <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-sm bg-indigo-900"></div>Bé¸æŠ</div>
                            <div class="flex items-center gap-1.5"><div class="w-3 h-3 rounded-sm" style="background: linear-gradient(135deg, #2563eb 50%, #4338ca 50%)"></div>ä¸¡æ–¹ã§é¸æŠ</div>
                        </div>
                    </div>
                </div>
            </section>

            <main id="main-content" class="space-y-8 min-w-0">
                <div class="bg-slate-200/50 p-1.5 rounded-2xl flex overflow-x-auto gap-1 no-scrollbar border border-slate-200 shadow-inner" id="category-tabs"></div>
                <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 2xl:grid-cols-5 gap-3" id="metric-grid"></div>

                <section class="bg-white rounded-[3rem] border border-slate-200 shadow-soft overflow-hidden">
                    <div class="p-8 lg:p-12 space-y-12">
                        
                        <div class="flex flex-col md:flex-row md:items-center justify-between gap-6">
                            <div class="space-y-2">
                                <div class="flex items-center gap-3">
                                    <h2 class="text-3xl font-black text-slate-800 tracking-tight" id="active-metric-title">---</h2>
                                    <span class="px-3 py-1 bg-blue-50 text-blue-600 rounded-full text-[10px] font-black uppercase tracking-tighter" id="active-metric-cat-label">CATEGORY</span>
                                </div>
                                <div class="flex flex-wrap items-center gap-x-4 gap-y-1">
                                    <p class="text-sm text-slate-400 font-medium" id="active-metric-info"></p>
                                    <div class="flex items-center gap-1.5">
                                        <a id="metric-source-link" href="#" target="_blank" class="text-blue-500 hover:text-blue-700 font-bold text-[11px] transition-all flex items-center gap-1 bg-blue-50/50 px-2 py-0.5 rounded-md border border-blue-100/50">
                                            <span id="metric-source-name">çµ±è¨ˆå</span>
                                            <svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"><path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"/><polyline points="15 3 21 3 21 9"/><line x1="10" y1="14" x2="21" y2="3"/></svg>
                                        </a>
                                    </div>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap bg-slate-100 p-1 rounded-xl border border-slate-200 self-start shadow-inner max-w-full" id="summary-agg-switcher">
                                <button onclick="setSummaryAggMode('sum')" id="btn-sum-sum" class="px-3 py-1.5 rounded-lg text-[10px] font-black transition-all">åˆè¨ˆ</button>
                                <button onclick="setSummaryAggMode('avg')" id="btn-sum-avg" class="px-3 py-1.5 rounded-lg text-[10px] font-black transition-all">å˜ç´”å¹³å‡</button>
                                <button onclick="setSummaryAggMode('wAvg')" id="btn-sum-wAvg" class="px-3 py-1.5 rounded-lg text-[10px] font-black transition-all">åŠ é‡å¹³å‡</button>
                                <button onclick="setSummaryAggMode('median')" id="btn-sum-median" class="px-3 py-1.5 rounded-lg text-[10px] font-black transition-all">ä¸­å¤®å€¤</button>
                                <button onclick="setSummaryAggMode('max')" id="btn-sum-max" class="px-3 py-1.5 rounded-lg text-[10px] font-black transition-all">æœ€å¤§</button>
                                <button onclick="setSummaryAggMode('min')" id="btn-sum-min" class="px-3 py-1.5 rounded-lg text-[10px] font-black transition-all">æœ€å°</button>
                            </div>
                        </div>

                        <!-- ã‚°ãƒ©ãƒ•ï¼šã‚°ãƒ«ãƒ¼ãƒ—é›†è¨ˆ -->
                        <div class="bg-slate-50 rounded-[2.5rem] border border-slate-100 p-8 h-[350px] shadow-inner relative text-center">
                            <canvas id="chartSummary"></canvas>
                        </div>

                        <!-- å‹•çš„ã‚¤ãƒ³ã‚µã‚¤ãƒˆ -->
                        <div class="p-8 lg:p-10 bg-indigo-50/50 rounded-[2.5rem] border border-indigo-100 shadow-soft relative overflow-hidden group">
                            <div class="absolute top-0 left-0 w-2 h-full bg-indigo-500"></div>
                            <div class="relative z-10 space-y-4">
                                <div class="flex items-center gap-3 text-indigo-700">
                                    <div class="p-2 bg-white rounded-lg shadow-sm font-black text-sm">?</div>
                                    <h3 class="text-base font-black uppercase tracking-widest leading-none">ã“ã®ãƒ‡ãƒ¼ã‚¿ã®ã€Œå·®ã€ãŒç¤ºã™æ„å‘³</h3>
                                </div>
                                <div class="grid grid-cols-1 md:grid-cols-2 gap-10 items-center">
                                    <div class="space-y-4 text-left">
                                        <p class="text-xl font-black text-slate-800 leading-tight" id="metric-insight-title">---</p>
                                        <p class="text-sm text-slate-600 leading-relaxed font-medium" id="metric-insight-desc">---</p>
                                    </div>
                                    <div class="bg-white/90 p-5 rounded-2xl border border-indigo-100 shadow-sm flex flex-col gap-4 text-left">
                                        <div class="flex items-start gap-3">
                                            <div class="w-5 h-5 rounded-full bg-indigo-600 text-white flex items-center justify-center shrink-0 mt-0.5 font-black text-[10px]">!</div>
                                            <p class="text-[11px] font-bold text-slate-500 leading-snug" id="metric-insight-tip1">---</p>
                                        </div>
                                        <div class="flex items-start gap-3 pt-3 border-t border-indigo-50">
                                            <div class="w-5 h-5 rounded-full bg-indigo-600 text-white flex items-center justify-center shrink-0 mt-0.5 font-black text-[10px]">!</div>
                                            <p class="text-[11px] font-bold text-slate-500 leading-snug" id="metric-insight-tip2">---</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <!-- ã‚°ãƒ©ãƒ•ï¼šå€‹åˆ¥å†…è¨³ -->
                        <div class="grid grid-cols-1 lg:grid-cols-2 gap-10 h-[500px]">
                            <div class="flex flex-col h-full bg-white rounded-[2.5rem] p-6 border border-slate-100 shadow-sm relative text-center">
                                <span class="absolute top-6 right-6 text-[9px] font-black text-slate-300 uppercase tracking-widest italic">Breakdown Group A</span>
                                <div class="flex-1 min-h-0"><canvas id="chartA"></canvas></div>
                            </div>
                            <div class="flex flex-col h-full bg-white rounded-[2.5rem] p-6 border border-slate-100 shadow-sm relative text-center">
                                <span class="absolute top-6 right-6 text-[9px] font-black text-slate-300 uppercase tracking-widest italic">Breakdown Group B</span>
                                <div class="flex-1 min-h-0"><canvas id="chartB"></canvas></div>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- ãƒ•ãƒƒã‚¿ãƒ¼ -->
                <div class="bg-slate-900 rounded-[3rem] p-12 text-white relative overflow-hidden shadow-2xl mt-8">
                    <div class="absolute top-0 right-0 w-64 h-64 bg-blue-500/10 blur-[100px] -mr-32 -mt-32"></div>
                    <div class="relative z-10 grid grid-cols-1 lg:grid-cols-2 gap-12 items-center text-center lg:text-left">
                        <div class="space-y-6">
                            <h3 class="text-3xl font-black leading-tight text-white">å²©æ‰‹ã®æœªæ¥ã‚’<br><span class="text-blue-400 italic font-medium">ãƒ‡ãƒ¼ã‚¿</span>ã‹ã‚‰æ§‹æƒ³ã™ã‚‹ã€‚</h3>
                            <p class="text-slate-400 text-sm font-medium leading-relaxed max-w-lg mx-auto lg:mx-0">
                                æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯å…¬çš„çµ±è¨ˆã«åŸºã¥ãå¯è¦–åŒ–ã‚’è¡Œã£ã¦ã„ã¾ã™ã€‚33è‡ªæ²»ä½“ã®ç‰¹æ€§ã‚’å¤šè§’çš„ã«æ‰ãˆã‚‹ã“ã¨ã§ã€æ¬¡ä¸–ä»£ã¸ã®æ”¿ç­–æè¨€ã‚„åœ°åŸŸèª²é¡Œã®ç™ºè¦‹ã‚’æ”¯æ´ã—ã¾ã™ã€‚
                            </p>
                        </div>
                        <div class="grid grid-cols-2 gap-4">
                            <div class="bg-white/5 p-6 rounded-3xl border border-white/5 backdrop-blur-sm shadow-lg">
                                <div class="text-[10px] uppercase text-blue-400 font-black tracking-widest mb-1">å¯¾è±¡è‡ªæ²»ä½“</div>
                                <div class="text-4xl font-black text-white leading-none">33</div>
                                <div class="text-[9px] text-slate-500 font-bold mt-2 italic uppercase">Municipalities</div>
                            </div>
                            <div class="bg-white/5 p-6 rounded-3xl border border-white/5 backdrop-blur-sm shadow-lg">
                                <div class="text-[10px] uppercase text-blue-400 font-black tracking-widest mb-1">åˆ†ææŒ‡æ¨™æ•°</div>
                                <div class="text-4xl font-black text-white leading-none">56</div>
                                <div class="text-[9px] text-slate-500 font-bold mt-2 italic uppercase">Verified Metrics</div>
                            </div>
                        </div>
                    </div>
                </div>
            </main>
        </div>
    </div>

    <script>
        // --- DATA æ¨è¨ˆå€¤ ---
        const MUNICIPAL_DATA = [
            { id: 1, name: 'ç››å²¡å¸‚', region: 'çœŒå¤®åºƒåŸŸåœ', population: 283541, area: 886.47, financialIndex: 0.62, elderlyRate: 29.5, income: 3100, households: 128000 },
            { id: 2, name: 'å®®å¤å¸‚', region: 'æ²¿å²¸åºƒåŸŸåœ', population: 48512, area: 1259.15, financialIndex: 0.28, elderlyRate: 41.2, income: 2600, households: 21000 },
            { id: 3, name: 'å¤§èˆ¹æ¸¡å¸‚', region: 'æ²¿å²¸åºƒåŸŸåœ', population: 31920, area: 192.30, financialIndex: 0.35, elderlyRate: 39.8, income: 2750, households: 13500 },
            { id: 4, name: 'èŠ±å·»å¸‚', region: 'çœŒå—åºƒåŸŸåœ', population: 91100, area: 908.39, financialIndex: 0.48, elderlyRate: 34.2, income: 2850, households: 36000 },
            { id: 5, name: 'åŒ—ä¸Šå¸‚', region: 'çœŒå—åºƒåŸŸåœ', population: 91436, area: 437.55, financialIndex: 0.65, elderlyRate: 28.1, income: 3200, households: 38000 },
            { id: 6, name: 'ä¹…æ…ˆå¸‚', region: 'çœŒåŒ—åºƒåŸŸåœ', population: 31745, area: 623.50, financialIndex: 0.26, elderlyRate: 38.5, income: 2500, households: 13800 },
            { id: 7, name: 'é é‡å¸‚', region: 'çœŒå—åºƒåŸŸåœ', population: 24716, area: 825.97, financialIndex: 0.23, elderlyRate: 40.1, income: 2550, households: 9800 },
            { id: 8, name: 'ä¸€é–¢å¸‚', region: 'çœŒå—åºƒåŸŸåœ', population: 108502, area: 1256.42, financialIndex: 0.40, elderlyRate: 36.8, income: 2700, households: 42000 },
            { id: 9, name: 'é™¸å‰é«˜ç”°å¸‚', region: 'æ²¿å²¸åºƒåŸŸåœ', population: 17234, area: 231.94, financialIndex: 0.18, elderlyRate: 42.5, income: 2450, households: 6800 },
            { id: 10, name: 'é‡œçŸ³å¸‚', region: 'æ²¿å²¸åºƒåŸŸåœ', population: 30456, area: 440.34, financialIndex: 0.38, elderlyRate: 43.1, income: 2700, households: 14500 },
            { id: 11, name: 'äºŒæˆ¸å¸‚', region: 'çœŒåŒ—åºƒåŸŸåœ', population: 24500, area: 420.42, financialIndex: 0.25, elderlyRate: 39.2, income: 2500, households: 10500 },
            { id: 12, name: 'å…«å¹¡å¹³å¸‚', region: 'çœŒå¤®åºƒåŸŸåœ', population: 23200, area: 862.30, financialIndex: 0.27, elderlyRate: 40.5, income: 2550, households: 9200 },
            { id: 13, name: 'å¥¥å·å¸‚', region: 'çœŒå—åºƒåŸŸåœ', population: 109800, area: 993.30, financialIndex: 0.45, elderlyRate: 33.5, income: 2900, households: 41000 },
            { id: 14, name: 'æ»æ²¢å¸‚', region: 'çœŒå¤®åºƒåŸŸåœ', population: 55200, area: 182.32, financialIndex: 0.52, elderlyRate: 25.8, income: 3000, households: 23000 },
            { id: 15, name: 'é›«çŸ³ç”º', region: 'çœŒå¤®åºƒåŸŸåœ', population: 15200, area: 608.82, financialIndex: 0.32, elderlyRate: 38.1, income: 2650, households: 6200 },
            { id: 16, name: 'è‘›å·»ç”º', region: 'çœŒå¤®åºƒåŸŸåœ', population: 5300, area: 434.96, financialIndex: 0.12, elderlyRate: 48.2, income: 2400, households: 2100 },
            { id: 17, name: 'å²©æ‰‹ç”º', region: 'çœŒå¤®åºƒåŸŸåœ', population: 11500, area: 360.46, financialIndex: 0.24, elderlyRate: 42.1, income: 2500, households: 4500 },
            { id: 18, name: 'ç´«æ³¢ç”º', region: 'çœŒå¤®åºƒåŸŸåœ', population: 32500, area: 238.98, financialIndex: 0.46, elderlyRate: 32.5, income: 2800, households: 11500 },
            { id: 19, name: 'çŸ¢å·¾ç”º', region: 'çœŒå¤®åºƒåŸŸåœ', population: 27500, area: 60.32, financialIndex: 0.58, elderlyRate: 24.2, income: 2950, households: 10800 },
            { id: 20, name: 'è¥¿å’Œè³€ç”º', region: 'çœŒå—åºƒåŸŸåœ', population: 4900, area: 590.74, financialIndex: 0.10, elderlyRate: 52.1, income: 2350, households: 2200 },
            { id: 21, name: 'é‡‘ã‚±å´ç”º', region: 'çœŒå—åºƒåŸŸåœ', population: 15300, area: 179.76, financialIndex: 0.88, elderlyRate: 31.2, income: 3150, households: 5800 },
            { id: 22, name: 'å¹³æ³‰ç”º', region: 'çœŒå—åºƒåŸŸåœ', population: 7100, area: 45.97, financialIndex: 0.38, elderlyRate: 37.5, income: 2600, households: 2500 },
            { id: 23, name: 'ä½ç”°ç”º', region: 'æ²¿å²¸åºƒåŸŸåœ', population: 4800, area: 334.84, financialIndex: 0.15, elderlyRate: 46.8, income: 2450, households: 1800 },
            { id: 24, name: 'å¤§æ§Œç”º', region: 'æ²¿å²¸åºƒåŸŸåœ', population: 10500, area: 200.42, financialIndex: 0.22, elderlyRate: 43.5, income: 2550, households: 4200 },
            { id: 25, name: 'å±±ç”°ç”º', region: 'æ²¿å²¸åºƒåŸŸåœ', population: 13800, area: 262.81, financialIndex: 0.20, elderlyRate: 44.2, income: 2500, households: 5500 },
            { id: 26, name: 'å²©æ³‰ç”º', region: 'æ²¿å²¸åºƒåŸŸåœ', population: 8000, area: 992.36, financialIndex: 0.14, elderlyRate: 49.5, income: 2400, households: 3200 },
            { id: 27, name: 'ç”°é‡ç•‘æ‘', region: 'æ²¿å²¸åºƒåŸŸåœ', population: 3000, area: 132.83, financialIndex: 0.11, elderlyRate: 45.2, income: 2350, households: 1100 },
            { id: 28, name: 'æ™®ä»£æ‘', region: 'æ²¿å²¸åºƒåŸŸåœ', population: 2300, area: 69.66, financialIndex: 0.10, elderlyRate: 46.5, income: 2380, households: 900 },
            { id: 29, name: 'è»½ç±³ç”º', region: 'çœŒåŒ—åºƒåŸŸåœ', population: 8100, area: 245.82, financialIndex: 0.19, elderlyRate: 43.8, income: 2420, households: 3100 },
            { id: 30, name: 'é‡ç”°æ‘', region: 'çœŒåŒ—åºƒåŸŸåœ', population: 3800, area: 80.84, financialIndex: 0.15, elderlyRate: 42.1, income: 2400, households: 1400 },
            { id: 31, name: 'ä¹æˆ¸æ‘', region: 'çœŒåŒ—åºƒåŸŸåœ', population: 5300, area: 134.02, financialIndex: 0.12, elderlyRate: 44.5, income: 2480, households: 1900 },
            { id: 32, name: 'æ´‹é‡ç”º', region: 'çœŒåŒ—åºƒåŸŸåœ', population: 15200, area: 302.92, financialIndex: 0.21, elderlyRate: 42.8, income: 2500, households: 5800 },
            { id: 33, name: 'ä¸€æˆ¸ç”º', region: 'çœŒåŒ—åºƒåŸŸåœ', population: 11200, area: 300.03, financialIndex: 0.20, elderlyRate: 41.2, income: 2460, households: 4200 }
        ].map(d => {
            const p = d.population;
            const isCoastal = d.region === 'æ²¿å²¸åºƒåŸŸåœ';
            const isNorth = d.region === 'çœŒåŒ—åºƒåŸŸåœ';
            const isSouth = d.region === 'çœŒå—åºƒåŸŸåœ';
            return {
                ...d,
                // è¾²æ¥­
                agriEntities: Math.round(p * (isCoastal ? 0.012 : 0.032)),
                agriWorkers: Math.round(p * (isCoastal ? 0.015 : 0.045)),
                agriGDP: Math.round(p * (isCoastal ? 0.025 : 0.082)),
                agriArea: Math.round(d.area * (isCoastal ? 0.08 : 0.28)),
                // æ—æ¥­
                forestEntities: Math.round(d.area * 0.38),
                forestWorkers: Math.round(d.area * 0.58),
                forestGDP: Math.round(d.area * 1.45),
                forestArea: Math.round(d.area * 75),
                charcoalProd: Math.round(d.area * (isCoastal || isNorth ? 1.4 : 0.15)),
                // æ°´ç”£æ¥­
                fishEntities: isCoastal ? Math.round(p * 0.014) : 0,
                fishWorkers: isCoastal ? Math.round(p * 0.022) : 0,
                fishGDP: isCoastal ? Math.round(p * 0.14) : 0,
                // å•†å·¥æ¥­
                totalEst: Math.round(p * 0.048),
                majorIndCount: isNorth ? Math.round(p * 0.01) : Math.round(p * 0.005),
                totalEmp: Math.round(p * 0.42),
                retailEst: Math.round(p * 0.011),
                retailEmp: Math.round(p * 0.095),
                retailFloor: Math.round(p * 1.45),
                retailSales: Math.round(p * 2.85),
                manufEst: Math.round(p * 0.004),
                manufEmp: Math.round(p * 0.075),
                manufShipments: Math.round(p * (isSouth ? 0.19 : 0.045)),
                // æ•™è‚²
                elemCount: Math.max(1, Math.round(p / 7200)),
                elemStudent: Math.round(p * 0.042),
                jhCount: Math.max(1, Math.round(p / 14500)),
                jhStudent: Math.round(p * 0.023),
                // è¦³å…‰
                tourVisitors: Math.round(p * (['ç››å²¡å¸‚','å¹³æ³‰ç”º','èŠ±å·»å¸‚'].includes(d.name) ? 18 : 4.5) / 1000),
                tourRegionVisitors: Math.round(p * (['ç››å²¡å¸‚','å¹³æ³‰ç”º','èŠ±å·»å¸‚'].includes(d.name) ? 22 : 6) / 1000),
                tourRatio: (Math.random() * 100).toFixed(1),
                tourRatioR5: (Math.random() * 100).toFixed(1),
                // äººå£ãƒ»ç¤¾ä¼š
                popDynamics: (Math.random() - 0.5) * 50,
                socialDynM: Math.round((Math.random() - 0.4) * 30),
                socialDynF: Math.round((Math.random() - 0.4) * 30),
                inMigP: Math.round(p * 0.012),
                inMigO: Math.round(p * 0.008),
                ageRatio: (Math.random() * 50).toFixed(1),
                indWorkersR2: Math.round(p * 0.45),
                incomeR3: Math.round(p * 3500),
                seasonalWorkers: Math.round(p * 0.0005),
                suicide: Math.round(p * 0.00018),
                density: parseFloat((p / d.area).toFixed(1))
            };
        });

        const METRICS = {
            // è¾²æ¥­
            agriEntities: { label: 'è¾²æ¥­çµŒå–¶ä½“æ•°', unit: 'ä½“', cat: 'agri', icon: 'ğŸŒ¾', bestAgg: 'sum', sourceName: 'è¾²æ—æ¥­ã‚»ãƒ³ã‚µã‚¹', insightTitle: 'è¾²æ¥­åŸºç›¤ã®åšã¿', insightDesc: 'çµŒå–¶ä½“æ•°ã®å·®ã¯ã€åœ°åŸŸã®é£Ÿã‚’æ”¯ãˆã‚‹æ‹…ã„æ‰‹ã®å¤šã•ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'åˆè¨ˆå€¤ã®å·®ã¯ã€åœåŸŸãŒé£Ÿæ–™ä¾›çµ¦åŸºåœ°ã¨ã—ã¦æŒã¤ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚’ç¤ºã—ã¾ã™ã€‚', tip2: 'æ¸›å°‘ã‚¹ãƒ”ãƒ¼ãƒ‰ãŒæ—©ã„åœ°åŸŸã¯ã€è€•ä½œæ”¾æ£„åœ°ã®æ‹¡å¤§ãƒªã‚¹ã‚¯ãŒé«˜ã¾ã‚Šã¾ã™ã€‚' },
            agriWorkers: { label: 'è¾²æ¥­å°±æ¥­è€…æ•°', unit: 'äºº', cat: 'agri', icon: 'ğŸ§‘â€ğŸŒ¾', bestAgg: 'sum', sourceName: 'è¾²æ—æ¥­ã‚»ãƒ³ã‚µã‚¹', insightTitle: 'è¾²æ¥­åŠ´åƒåŠ›ã®ç¶­æŒ', insightDesc: 'å°±æ¥­è€…æ•°ã®å·®ã¯ã€åœ°åŸŸã®ãƒ¡ã‚¤ãƒ³ç”£æ¥­ã¨ã—ã¦ã®è¾²æ¥­ã¸ã®ä¾å­˜åº¦ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'é«˜é½¢åŒ–ç‡ã¨ä½µã›ã¦è¦‹ã‚‹ã“ã¨ã§ã€æ‹…ã„æ‰‹ä¸è¶³ã®æ·±åˆ»åº¦ãŒæµ®ãå½«ã‚Šã«ãªã‚Šã¾ã™ã€‚', tip2: 'çœŒå—ã‚¨ãƒªã‚¢ã®å„ªä½æ€§ãŒæ•°å€¤ã«é¡•è‘—ã«ç¾ã‚Œã‚‹é …ç›®ã§ã™ã€‚' },
            agriGDP: { label: 'è¾²æ¥­ç”Ÿç”£é¡', unit: 'ç™¾ä¸‡å††', cat: 'agri', icon: 'ğŸ’°', bestAgg: 'sum', sourceName: 'çµŒæ¸ˆè¨ˆç®—', insightTitle: 'è¾²æ¥­ã®ç¨¼ãåŠ›', insightDesc: 'ç”Ÿç”£é¡ã®å·®ã¯ã€ä»˜åŠ ä¾¡å€¤ã®é«˜ã„ä½œç‰©ã®é›†ç©åº¦åˆã„ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'çµŒå–¶ä½“æ•°ãŒå°‘ãªãã¦ã‚‚ç”Ÿç”£é¡ãŒé«˜ã„åœ°åŸŸã¯ã€å¤§è¦æ¨¡åŠ¹ç‡åŒ–ãŒé€²ã‚“ã§ã„ã¾ã™ã€‚', tip2: 'ä¸»åŠ›å“ç›®ã®é•ã„ãŒã€ã‚°ãƒ«ãƒ¼ãƒ—å…¨ä½“ã®åç›Šæ§‹é€ ã®å·®ã¨ãªã£ã¦ç¾ã‚Œã¾ã™ã€‚' },
            agriArea: { label: 'çµŒå–¶è€•åœ°é¢ç©', unit: 'ha', cat: 'agri', icon: 'ğŸšœ', bestAgg: 'sum', sourceName: 'è¾²æ—æ¥­ã‚»ãƒ³ã‚µã‚¹', insightTitle: 'è¾²åœ°ã®æ´»ç”¨è¦æ¨¡', insightDesc: 'è€•åœ°é¢ç©ã®å·®ã¯ã€åœŸåœ°åˆ©ç”¨å‹è¾²æ¥­ã®å®Ÿæ–½ãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'åºƒå¤§ãªé¢ç©ã¯ã€å°†æ¥ã®ã‚¹ãƒãƒ¼ãƒˆè¾²æ¥­å°å…¥ã®ãƒ™ãƒ¼ã‚¹ã¨ãªã‚Šã¾ã™ã€‚', tip2: 'è€•ä½œé¢ç©ã®ç¶­æŒãŒã€æ™¯è¦³ä¿å…¨æ©Ÿèƒ½ã®ç¶­æŒã«ã‚‚ç›´çµã—ã¾ã™ã€‚' },
            // æ—æ¥­
            forestEntities: { label: 'æ—æ¥­çµŒå–¶ä½“æ•°', unit: 'ä½“', cat: 'forest', icon: 'ğŸŒ²', bestAgg: 'sum', sourceName: 'è¾²æ—æ¥­ã‚»ãƒ³ã‚µã‚¹', insightTitle: 'æ£®æ—ç®¡ç†ã®æ‹…ã„æ‰‹', insightDesc: 'çµŒå–¶ä½“æ•°ã¯ã€æ£®æ—è³‡æºã‚’æŒç¶šçš„ã«ç®¡ç†ãƒ»æ´»ç”¨ã§ãã‚‹ä½“åˆ¶ã®åšã¿ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'å²©æ‰‹ã¯å…¨å›½æœ‰æ•°ã®æ—æ¥­çœŒã€‚ãã®æ ¸ã¨ãªã‚‹è‡ªæ²»ä½“ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚', tip2: 'å°è¦æ¨¡çµŒå–¶ä½“ãŒå¤šã„åœ°åŸŸã¯ã€é›†ç´„åŒ–ã«ã‚ˆã‚‹åŠ¹ç‡å‘ä¸ŠãŒä»Šå¾Œã®èª²é¡Œã§ã™ã€‚' },
            forestWorkers: { label: 'æ—æ¥­å°±æ¥­è€…æ•°', unit: 'äºº', cat: 'forest', icon: 'ğŸª“', bestAgg: 'sum', sourceName: 'å›½å‹¢èª¿æŸ»', insightTitle: 'æ£®æ—ç®¡ç†åŠ´åƒåŠ›', insightDesc: 'å°±æ¥­è€…æ•°ã®å·®ã¯ã€è³‡æºç®¡ç†ã®å®Ÿæ–½èƒ½åŠ›ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'æ•°å€¤ã®ä½ä¸‹ã¯ã€å±±æ—ã®è’å»ƒãƒªã‚¹ã‚¯ã‚’ç›´æ¥çš„ã«ç¤ºå”†ã—ã¾ã™ã€‚', tip2: 'å°±æ¥­è€…ã‚ãŸã‚Šã®ç®¡ç†é¢ç©ã‚’å‰²ã‚Šå‡ºã™ã“ã¨ã§ã€è² æ‹…ã®é‡ã•ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚' },
            forestGDP: { label: 'æ—æ¥­ç”Ÿç”£é¡', unit: 'ç™¾ä¸‡å††', cat: 'forest', icon: 'â›°ï¸', bestAgg: 'sum', sourceName: 'çµŒæ¸ˆè¨ˆç®—', insightTitle: 'æ£®æ—ã®çµŒæ¸ˆä¾¡å€¤', insightDesc: 'ç”Ÿç”£é¡ã®å·®ã¯ã€æœ¨æå‡ºè·èƒ½åŠ›ã‚„ç‰¹ç”¨æ—ç”£ç‰©ã®æŒ¯èˆˆåº¦ã‚’åæ˜ ã—ã¾ã™ã€‚', tip1: 'çœŒåŒ—ãƒ»æ²¿å²¸éƒ¨ã®è²¢çŒ®åº¦ãŒã€ã‚°ãƒ«ãƒ¼ãƒ—åˆè¨ˆã«åæ˜ ã•ã‚Œã¾ã™ã€‚', tip2: 'ãƒã‚¤ã‚ªãƒã‚¹åˆ©ç”¨ãªã©ã®æ–°ãŸãªä¾¡å€¤å‰µå‡ºã®åŸºç›¤ã¨ãªã‚Šã¾ã™ã€‚' },
            forestArea: { label: 'æ—å®¶ä¿æœ‰å±±æ—é¢ç©', unit: 'ha', cat: 'forest', icon: 'ğŸŒ³', bestAgg: 'sum', sourceName: 'è¾²æ—æ¥­ã‚»ãƒ³ã‚µã‚¹', insightTitle: 'æ£®æ—è³‡æºã®ã‚¹ãƒˆãƒƒã‚¯', insightDesc: 'ä¿æœ‰é¢ç©ã®å·®ã¯ã€å°†æ¥ã®åç›Šãƒãƒ†ãƒ³ã‚·ãƒ£ãƒ«ã¨å¸åæºã¨ã—ã¦ã®ä¾¡å€¤ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'åºƒå¤§ãªé¢ç©ã¯ã€è„±ç‚­ç´ ç¤¾ä¼šã«ãŠã‘ã‚‹J-ã‚¯ãƒ¬ã‚¸ãƒƒãƒˆç­‰ã®æ´»ç”¨ä½™åœ°ã‚‚ç¤ºã—ã¾ã™ã€‚', tip2: 'å…¬æœ‰æ—ã¨ç§æœ‰æ—ã®æ¯”ç‡ã‚‚ã€æ–½ç­–ä¸Šã®é‡è¦ãªè¦–ç‚¹ã§ã™ã€‚' },
            charcoalProd: { label: 'æœ¨ç‚­ç”Ÿç”£é‡', unit: 'ãƒˆãƒ³', cat: 'forest', icon: 'ğŸ”¥', bestAgg: 'sum', sourceName: 'ç‰¹ç”¨æ—ç”£ç‰©èª¿æŸ»', insightTitle: 'ä¼çµ±ç”£æ¥­ã®ç¶™æ‰¿åŠ›', insightDesc: 'ç”Ÿç”£é‡ã®å·®ã¯ã€æ—¥æœ¬ä¸€ã®ãƒ–ãƒ©ãƒ³ãƒ‰ã‚’æ”¯ãˆã‚‹æŠ€èƒ½ã®é›†ç©ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'ç‰¹å®šã®ç‰¹å®šåœåŸŸã«é›†ç©ã—ã¦ãŠã‚Šã€åœ°åŸŸç‹¬è‡ªã®æ–‡åŒ–ã‚’å½¢æˆã—ã¦ã„ã¾ã™ã€‚', tip2: 'ç‡ƒæ–™ä»¥å¤–ã®æµ„åŒ–ãƒ»åœŸå£Œæ”¹è‰¯ç”¨é€”ã¸ã®å±•é–‹ã‚‚æœŸå¾…ã•ã‚Œã‚‹åˆ†é‡ã§ã™ã€‚' },
            // æ°´ç”£æ¥­
            fishEntities: { label: 'æ¼æ¥­çµŒå–¶ä½“æ•°', unit: 'ä½“', cat: 'fish', icon: 'ğŸŸ', bestAgg: 'sum', sourceName: 'æ¼æ¥­ã‚»ãƒ³ã‚µã‚¹', insightTitle: 'æµœã®æ´»åŠ›ã¨ç¶™ç¶šæ€§', insightDesc: 'çµŒå–¶ä½“æ•°ã¯ã€æ¼æ‘ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£ã®ç¶­æŒåŸºç›¤ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'æ²¿å²¸éƒ¨ç‰¹æœ‰ã®æŒ‡æ¨™ã§ã‚ã‚Šã€å†…é™¸ã‚°ãƒ«ãƒ¼ãƒ—ã¨ã®æ˜ç¢ºãªæ§‹é€ å·®ã‚’ç¤ºã—ã¾ã™ã€‚', tip2: 'æ‹…ã„æ‰‹ã®æ¸›å°‘ç‡ã®å·®ãŒã€åœ°åŸŸã®æœªæ¥åƒã«ç›´çµã—ã¾ã™ã€‚' },
            fishWorkers: { label: 'æ¼æ¥­å°±æ¥­è€…æ•°', unit: 'äºº', cat: 'fish', icon: 'ğŸ£', bestAgg: 'sum', sourceName: 'æ¼æ¥­ã‚»ãƒ³ã‚µã‚¹', insightTitle: 'æ¼æ¥­åŠ´åƒåŠ›', insightDesc: 'å°±æ¥­è€…æ•°ã¯ã€æ°´æšã’èƒ½åŠ›ã‚„é¤Šæ®–ç®¡ç†ã®ã‚­ãƒ£ãƒ‘ã‚·ãƒ†ã‚£ã«ç›´çµã—ã¾ã™ã€‚', tip1: 'é«˜é½¢åŒ–ãŒæœ€ã‚‚é¡•è‘—ãªåˆ†é‡ã®ä¸€ã¤ã€‚å¾Œç¶™è€…ç¢ºä¿ã®å·®ãŒè¦‹ãˆã¾ã™ã€‚', tip2: 'åŠ å·¥æ¥­ã¸ã®é›‡ç”¨æ³¢åŠåŠ¹æœã®æºæ³‰ã¨ãªã‚‹é‡è¦ãªæ•°å€¤ã§ã™ã€‚' },
            fishGDP: { label: 'æ°´ç”£æ¥­ç”Ÿç”£é¡', unit: 'ç™¾ä¸‡å††', cat: 'fish', icon: 'ğŸŒŠ', bestAgg: 'sum', sourceName: 'çµŒæ¸ˆè¨ˆç®—', insightTitle: 'æµ·ã®çµŒæ¸ˆã‚¹ã‚±ãƒ¼ãƒ«', insightDesc: 'ç”Ÿç”£é¡ã®å·®ã¯ã€ä¸»è¦é­šç¨®ã®å¥½ä¸æ¼ã‚„é¤Šæ®–ã®æˆå¦ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'ä¸»è¦æ¸¯ã®æœ‰ç„¡ãŒã€ã‚°ãƒ«ãƒ¼ãƒ—å…¨ä½“ã®æ•°å€¤ã‚’æ±ºå®šã¥ã‘ã¾ã™ã€‚', tip2: 'ã€Œç²ã‚‹æ¼æ¥­ã€ã‹ã‚‰ã€Œè‚²ã¦ã‚‹æ¼æ¥­ã€ã¸ã®è»¢æ›åº¦åˆã„ã‚‚ç¾ã‚Œã¾ã™ã€‚' },
            // å•†å·¥æ¥­
            totalEst: { label: 'å…¨äº‹æ¥­æ‰€æ•°', unit: 'æ‰€', cat: 'comm', icon: 'ğŸ¢', bestAgg: 'sum', sourceName: 'çµŒæ¸ˆã‚»ãƒ³ã‚µã‚¹', insightTitle: 'çµŒæ¸ˆæ´»å‹•ã®å¤šæ§˜æ€§', insightDesc: 'äº‹æ¥­æ‰€æ•°ã®å·®ã¯ã€åœ°åŸŸã®ãƒ“ã‚¸ãƒã‚¹ãƒãƒ£ãƒ³ã‚¹ã¨é›‡ç”¨ã®é¸æŠè‚¢ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'éƒ½å¸‚éƒ¨ã¸ã®é›†ç©åº¦ãŒã€ã‚°ãƒ«ãƒ¼ãƒ—é–“ã®æ•°å€¤å·®ã¨ã—ã¦å¦‚å®Ÿã«ç¾ã‚Œã¾ã™ã€‚', tip2: '1äº‹æ¥­æ‰€ã‚ãŸã‚Šã®å¾“æ¥­å“¡æ•°ã‹ã‚‰ã€ç”£æ¥­ã®æ€§è³ªã‚’æ¨æ¸¬ã§ãã¾ã™ã€‚' },
            totalEmp: { label: 'å…¨å¾“æ¥­è€…æ•°', unit: 'äºº', cat: 'comm', icon: 'ğŸ‘”', bestAgg: 'sum', sourceName: 'çµŒæ¸ˆã‚»ãƒ³ã‚µã‚¹', insightTitle: 'åŠ´åƒå¸‚å ´ã®è¦æ¨¡', insightDesc: 'å¾“æ¥­è€…æ•°ã®å·®ã¯ã€åœ°åŸŸãŒã©ã‚Œã ã‘ã®åƒãå ´ã‚’æä¾›ã§ãã¦ã„ã‚‹ã‹ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'æ˜¼é–“äººå£ã®æµå…¥ãƒ»æµå‡ºã®å®Ÿæ…‹ã‚’åæ˜ ã™ã‚‹æŒ‡æ¨™ã§ã™ã€‚', tip2: 'ç”£æ¥­æ§‹é€ ã®ãƒãƒ©ãƒ³ã‚¹ãŒã€åœ°åŸŸã®å®‰å®šæ€§ã«å¯„ä¸ã—ã¾ã™ã€‚' },
            retailSales: { label: 'å°å£²å¹´é–“è²©å£²é¡', unit: 'å„„å††', cat: 'comm', icon: 'ğŸ›ï¸', bestAgg: 'sum', sourceName: 'å•†æ¥­çµ±è¨ˆ', insightTitle: 'å•†æ¥­ã®å¸å¼•åŠ›', insightDesc: 'è²©å£²é¡ã®å·®ã¯ã€è²·ã„ç‰©å®¢ã‚’ã©ã‚Œã ã‘å‘¨è¾ºã‹ã‚‰å‘¼ã³å¯„ã›ã¦ã„ã‚‹ã‹ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'äººå£æ¯”ã§è²©å£²é¡ãŒé«˜ã„åœ°åŸŸã¯ã€åºƒåŸŸã‚»ãƒ³ã‚¿ãƒ¼æ©Ÿèƒ½ã‚’æŒã£ã¦ã„ã¾ã™ã€‚', tip2: 'æ¶ˆè²»ã‚¹ã‚¿ã‚¤ãƒ«ã®å¤‰åŒ–ï¼ˆECvså®Ÿåº—èˆ—ï¼‰ãŒæ•°å€¤ã®å·®ã«ç¾ã‚Œã¾ã™ã€‚' },
            manufShipments: { label: 'è£½é€ å“å‡ºè·é¡', unit: 'å„„å††', cat: 'comm', icon: 'ğŸ­', bestAgg: 'sum', sourceName: 'å·¥æ¥­çµ±è¨ˆ', insightTitle: 'ç¨¼ãã‚¨ãƒ³ã‚¸ãƒ³ã®å¼·ã•', insightDesc: 'å‡ºè·é¡ã®å·®ã¯ã€åœ°åŸŸçµŒæ¸ˆã‚’ç‰½å¼•ã™ã‚‹è£½é€ æ¥­ã®ãƒ‘ãƒ¯ãƒ¼ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'åŒ—ä¸Šå·æµåŸŸã®è‡ªæ²»ä½“ã®é›†ç©ãŒçªå‡ºã—ã¦ç¾ã‚Œã‚‹é …ç›®ã§ã™ã€‚', tip2: 'ç‰¹å®šã®å¤§è¦æ¨¡å·¥å ´ã®æœ‰ç„¡ãŒã€ã‚°ãƒ«ãƒ¼ãƒ—åˆè¨ˆã‚’å¤§ããå·¦å³ã—ã¾ã™ã€‚' },
            // æ•™è‚²
            elemStudent: { label: 'å°å­¦æ ¡å…ç«¥æ•°', unit: 'äºº', cat: 'edu', icon: 'ğŸ’', bestAgg: 'sum', sourceName: 'å­¦æ ¡åŸºæœ¬èª¿æŸ»', insightTitle: 'æ¬¡ä¸–ä»£ã®ãƒœãƒªãƒ¥ãƒ¼ãƒ ', insightDesc: 'å…ç«¥æ•°ã®å·®ã¯ã€å°†æ¥ã®ç”Ÿç”£å¹´é½¢äººå£ã®äºˆå‚™è»ã®å¤šã•ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'æ•™è‚²ã‚¤ãƒ³ãƒ•ãƒ©ã®ç¶­æŒã‚³ã‚¹ãƒˆã‚„ã€é©æ­£é…ç½®ã®è­°è«–ã®åŸºç¤ã¨ãªã‚Šã¾ã™ã€‚', tip2: 'æ¸›å°‘ã‚¹ãƒ”ãƒ¼ãƒ‰ã®æ¯”è¼ƒãŒã€åœ°åŸŸã®å°†æ¥åƒäºˆæ¸¬ã«ä¸å¯æ¬ ã§ã™ã€‚' },
            jhStudent: { label: 'ä¸­å­¦æ ¡ç”Ÿå¾’æ•°', unit: 'äºº', cat: 'edu', icon: 'ğŸ“', bestAgg: 'sum', sourceName: 'å­¦æ ¡åŸºæœ¬èª¿æŸ»', insightTitle: 'é«˜æ ¡é€²å­¦å‰ã®äººå£å±¤', insightDesc: 'ç”Ÿå¾’æ•°ã®å·®ã¯ã€åœ°å…ƒã®é«˜æ ¡éœ€è¦ã‚„è‹¥å¹´å±¤ã®å®šä½åŸºç›¤ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'ä¸­å­¦å’æ¥­æ™‚ã®å¸‚å¤–æµå‡ºã®å®Ÿæ…‹ã‚’æ¢ã‚‹ãŸã‚ã®åŸºæº–å€¤ã¨ãªã‚Šã¾ã™ã€‚', tip2: 'éƒ¨æ´»å‹•ç­‰ã®ã‚³ãƒŸãƒ¥ãƒ‹ãƒ†ã‚£æ´»å‹•ã®ç¶­æŒèƒ½åŠ›ã«é–¢ã‚ã‚Šã¾ã™ã€‚' },
            // è¦³å…‰
            tourVisitors: { label: 'è¦³å…‰å®¢å…¥è¾¼æ•°', unit: 'åƒäºº', cat: 'tour', icon: 'ğŸƒ', bestAgg: 'sum', sourceName: 'è¦³å…‰çµ±è¨ˆ', insightTitle: 'äº¤æµäººå£ã«ã‚ˆã‚‹è³‘ã‚ã„', insightDesc: 'å…¥è¾¼æ•°ã®å·®ã¯ã€åœ°åŸŸã®ãƒ–ãƒ©ãƒ³ãƒ‰åŠ›ã¨å¤–è²¨ç²å¾—èƒ½åŠ›ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'æœ‰åè¦³å…‰åœ°ï¼ˆå¹³æ³‰ã€å…«å¹¡å¹³ãªã©ï¼‰ã®é›†å®¢åŠ›ãŒåæ˜ ã•ã‚Œã¾ã™ã€‚', tip2: 'ã€Œç‚¹ã€ã®è¦³å…‰ã‹ã‚‰ã€Œé¢ã€ã®è¦³å…‰ã¸ã®å±•é–‹ã‚’æ¸¬ã‚‹æŒ‡æ¨™ã§ã™ã€‚' },
            // ç¤¾ä¼šå‹•æ…‹
            population: { label: 'äººå£', unit: 'äºº', cat: 'social', icon: 'ğŸ‘¨â€ğŸ‘©â€ğŸ‘§â€ğŸ‘¦', bestAgg: 'sum', sourceName: 'æ¯æœˆäººå£æ¨è¨ˆ', insightTitle: 'è‡ªæ²»ä½“ã®åŸºç¤ä½“åŠ›', insightDesc: 'äººå£è¦æ¨¡ã®å·®ã¯ã€ã‚ã‚‰ã‚†ã‚‹å…¬å…±ã‚µãƒ¼ãƒ“ã‚¹åŠ¹ç‡ã¨å¸‚å ´è¦æ¨¡ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'çœŒå…¨ä½“ã«ãŠã‘ã‚‹ãã®åœåŸŸã®å½±éŸ¿åŠ›ã‚’ç¤ºã™çµ¶å¯¾çš„ãªæŒ‡æ¨™ã§ã™ã€‚', tip2: 'äººå£å¯†åº¦ã®å·®ã¨ä½µã›ã¦è¦‹ã‚‹ã“ã¨ã§ã€å±…ä½åŠ¹ç‡ãŒåˆ†ã‹ã‚Šã¾ã™ã€‚' },
            income: { label: '1äººå½“ã‚Šæ‰€å¾—', unit: 'åƒå††', cat: 'social', icon: 'ğŸ’°', bestAgg: 'wAvg', sourceName: 'çµŒæ¸ˆè¨ˆç®—', insightTitle: 'ç”Ÿæ´»ã®è±Šã‹ã•æ°´æº–', insightDesc: 'æ‰€å¾—ã®å·®ã¯ã€ä½æ°‘ã®è³¼è²·åŠ›ã‚„ç”Ÿæ´»æº€è¶³åº¦ã‚’åæ˜ ã™ã‚‹å·®ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'åŠ é‡å¹³å‡ã«ã‚ˆã‚Šã€äººå£è¦æ¨¡ã«å·¦å³ã•ã‚Œãªã„å®ŸåŠ›ã‚’æ¸¬ã‚Œã¾ã™ã€‚', tip2: 'æ ¼å·®ã®æŠŠæ¡ã«ã¯æœ€å¤§ãƒ»æœ€å°å€¤ã‚„ä¸­å¤®å€¤ã®æ¯”è¼ƒã‚‚æœ‰åŠ¹ã§ã™ã€‚' },
            suicide: { label: 'è‡ªæ®ºè€…æ•°', unit: 'äºº', cat: 'social', icon: 'ğŸ™', bestAgg: 'sum', sourceName: 'ç¦ç¥‰çµ±è¨ˆ', insightTitle: 'ç¤¾ä¼šã®å­¤ç«‹ãƒ»ã‚¹ãƒˆãƒ¬ã‚¹', insightDesc: 'æ•°å€¤ã®å·®ã¯ã€åœ°åŸŸã®ãƒ¡ãƒ³ã‚¿ãƒ«ãƒ˜ãƒ«ã‚¹èª²é¡Œã‚„ã‚µãƒãƒ¼ãƒˆç¶²ã®å¿…è¦æ€§ã‚’æ„å‘³ã—ã¾ã™ã€‚', tip1: 'å®Ÿæ•°ã ã‘ã§ãªãã€äººå£æ¯”ã§ã®æ¯”è¼ƒãŒåˆ†æä¸Šå¿…é ˆã§ã™ã€‚', tip2: 'èƒŒæ™¯ã«ã‚ã‚‹çµŒæ¸ˆãƒ»å®¶æ—å•é¡Œã¸ã®å¯¾ç­–æŒ‡æ¨™ã¨ãªã‚Šã¾ã™ã€‚' }
        };

        const CATEGORIES = {
            lifestyle: { label: 'åŸºæœ¬æƒ…å ±', icon: 'ğŸ—ºï¸', color: '#64748b' },
            agri: { label: 'è¾²æ¥­', icon: 'ğŸŒ¾', color: '#16a34a' },
            forest: { label: 'æ—æ¥­', icon: 'ğŸŒ²', color: '#059669' },
            fish: { label: 'æ°´ç”£æ¥­', icon: 'ğŸŸ', color: '#0891b2' },
            comm: { label: 'å•†å·¥æ¥­', icon: 'ğŸ­', color: '#d97706' },
            edu: { label: 'æ•™è‚²', icon: 'ğŸ“', color: '#4f46e5' },
            tour: { label: 'è¦³å…‰', icon: 'âœˆï¸', color: '#e11d48' },
            social: { label: 'ç¤¾ä¼šå‹•æ…‹', icon: 'ğŸ˜ï¸', color: '#2563eb' }
        };

        let state = {
            selectedIdsA: [1, 14, 18], 
            selectedIdsB: [5, 13, 21], 
            activeEditGroup: 'A',
            activeMetric: 'population',
            activeCat: 'lifestyle',
            summaryAggMode: 'sum', 
            charts: { summary: null, A: null, B: null }
        };

        const getEl = (id) => document.getElementById(id);

        function init() {
            renderTabs();
            renderList();
            setActiveMetric('population');
        }

        function setEditGroup(group) {
            state.activeEditGroup = group;
            getEl('btn-edit-A').className = group === 'A' ? "flex-1 py-3 rounded-xl text-xs font-black transition-all group-tab-active-A" : "flex-1 py-3 rounded-xl text-xs font-black transition-all text-slate-400 hover:text-slate-600";
            getEl('btn-edit-B').className = group === 'B' ? "flex-1 py-3 rounded-xl text-xs font-black transition-all group-tab-active-B" : "flex-1 py-3 rounded-xl text-xs font-black transition-all text-slate-400 hover:text-slate-600";
            renderList();
        }

        function setSummaryAggMode(mode) {
            state.summaryAggMode = mode;
            updateAggSwitcherUI();
            updateCharts();
        }

        function updateAggSwitcherUI() {
            document.querySelectorAll('#summary-agg-switcher button').forEach(btn => btn.className = 'px-3 py-1.5 rounded-lg text-[10px] font-black transition-all agg-btn-inactive hover:bg-slate-200');
            const targetBtn = getEl(`btn-sum-${state.summaryAggMode}`);
            if (targetBtn) targetBtn.className = 'px-3 py-1.5 rounded-lg text-[10px] font-black transition-all agg-btn-active';
        }

        function setCategory(cat) {
            state.activeCat = cat;
            renderTabs();
            const firstMetricKey = Object.keys(METRICS).find(m => METRICS[m].cat === cat);
            if (firstMetricKey) setActiveMetric(firstMetricKey);
        }

        function setActiveMetric(metricKey) {
            if (!METRICS[metricKey]) return;
            state.activeMetric = metricKey;
            state.summaryAggMode = METRICS[metricKey].bestAgg || 'sum';
            renderMetrics();
            updateUI();
        }

        function renderTabs() {
            let html = '';
            Object.entries(CATEGORIES).forEach(([k, v]) => {
                const isActive = state.activeCat === k;
                const style = `background-color: ${isActive ? v.color : 'transparent'}; color: ${isActive ? 'white' : '#64748b'}`;
                html += `<button onclick="setCategory('${k}')" style="${style}" class="px-5 py-2 rounded-xl text-[11px] font-bold transition-all border border-transparent ${isActive ? 'shadow-md' : 'hover:bg-white'}"><span>${v.icon}</span> ${v.label}</button>`;
            });
            getEl('category-tabs').innerHTML = html;
        }

        function renderMetrics() {
            let html = '';
            const catColor = CATEGORIES[state.activeCat].color;
            Object.entries(METRICS).filter(([_, m]) => m.cat === state.activeCat).forEach(([k, m]) => {
                const isActive = state.activeMetric === k;
                html += `
                    <button onclick="setActiveMetric('${k}')" class="px-4 py-3 rounded-2xl border-2 transition-all flex items-center gap-3 relative group ${isActive ? 'metric-btn-active shadow-lg' : 'bg-white/50 border-transparent text-slate-400 hover:border-slate-200 hover:bg-white shadow-soft'}" ${isActive ? `style="border-color:${catColor};"` : ''}>
                        <div class="text-xl shrink-0" ${isActive ? `style="color:${catColor}"` : ''}>${m.icon}</div>
                        <span class="text-[10px] font-black text-left leading-tight ${isActive ? 'text-slate-900' : ''}">${m.label}</span>
                    </button>`;
            });
            getEl('metric-grid').innerHTML = html;
            const badge = getEl('active-metric-cat-label');
            badge.innerText = CATEGORIES[state.activeCat].label;
            badge.style.backgroundColor = `${catColor}15`;
            badge.style.color = catColor;
        }

        function toggleCity(id) {
            const listKey = state.activeEditGroup === 'A' ? 'selectedIdsA' : 'selectedIdsB';
            const ids = state[listKey];
            const idx = ids.indexOf(id);
            if (idx > -1) { if (ids.length > 1) ids.splice(idx, 1); }
            else { ids.push(id); }
            renderList();
            updateCharts();
        }

        function selectByRegion(region) {
            const listKey = state.activeEditGroup === 'A' ? 'selectedIdsA' : 'selectedIdsB';
            const regionIds = MUNICIPAL_DATA.filter(d => d.region === region).map(d => d.id);
            const allSelected = regionIds.every(id => state[listKey].includes(id));
            if (allSelected) state[listKey] = state[listKey].filter(id => !regionIds.includes(id));
            else state[listKey] = [...new Set([...state[listKey], ...regionIds])];
            if (state[listKey].length === 0) state[listKey] = [1];
            renderList();
            updateCharts();
        }

        function selectAll() {
            const listKey = state.activeEditGroup === 'A' ? 'selectedIdsA' : 'selectedIdsB';
            state[listKey] = MUNICIPAL_DATA.map(d => d.id);
            renderList(); updateCharts();
        }
        function deselectAll() {
            const listKey = state.activeEditGroup === 'A' ? 'selectedIdsA' : 'selectedIdsB';
            state[listKey] = [1];
            renderList(); updateCharts();
        }

        function renderList() {
            let html = '';
            MUNICIPAL_DATA.forEach(d => {
                const inA = state.selectedIdsA.includes(d.id);
                const inB = state.selectedIdsB.includes(d.id);
                let btnClass = "bg-slate-50 border border-slate-100 text-slate-600 hover:border-blue-200 shadow-sm";
                if (inA && inB) btnClass = "both-selected";
                else if (inA) btnClass = "bg-blue-600 text-white border-none shadow-md";
                else if (inB) btnClass = "bg-indigo-900 text-white border-none shadow-md";
                html += `
                    <button onclick="toggleCity(${d.id})" class="text-left px-3 py-2.5 rounded-xl text-[9px] font-black transition-all flex items-center justify-between group ${btnClass}">
                        <span class="truncate">${d.name} (${d.region.substring(0, 2)})</span>
                        ${(inA || inB) ? '<svg xmlns="http://www.w3.org/2000/svg" width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="4" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"/></svg>' : ''}
                    </button>`;
            });
            getEl('city-list').innerHTML = html;
            const currentList = state.activeEditGroup === 'A' ? state.selectedIdsA : state.selectedIdsB;
            getEl('selection-count').innerText = `${state.activeEditGroup} ç·¨é›†ãƒ»é¸æŠä¸­ (${currentList.length})`;
        }

        function updateUI() {
            const m = METRICS[state.activeMetric];
            if(!m) return;
            getEl('active-metric-title').innerText = m.label;
            getEl('active-metric-info').innerText = `å˜ä½: ${m.unit || 'æŒ‡æ•°'} | ã‚°ãƒ«ãƒ¼ãƒ—æ¯”è¼ƒ`;
            getEl('metric-source-name').innerText = m.sourceName;
            getEl('metric-insight-title').innerText = m.insightTitle;
            getEl('metric-insight-desc').innerText = m.insightDesc;
            getEl('metric-insight-tip1').innerText = m.tip1;
            getEl('metric-insight-tip2').innerText = m.tip2;
            updateAggSwitcherUI();
            updateCharts();
        }

        function calculateGroupStats(ids, metric) {
            const members = MUNICIPAL_DATA.filter(d => ids.includes(d.id));
            const vals = members.map(d => d[metric] || 0);
            const popTotal = members.reduce((acc, c) => acc + c.population, 0);
            const sum = members.reduce((acc, c) => acc + (c[metric] || 0), 0);
            const avg = sum / (members.length || 1);
            const wAvg = members.reduce((acc, c) => acc + ((c[metric]||0) * c.population), 0) / (popTotal || 1);
            const max = Math.max(...vals, 0);
            const min = Math.min(...vals, 0);
            const sorted = [...vals].sort((a, b) => a - b);
            const mid = Math.floor(sorted.length / 2);
            const median = sorted.length % 2 !== 0 ? sorted[mid] : (sorted[mid - 1] + sorted[mid]) / 2;
            return { sum, avg, wAvg, max, min, median, vals };
        }

        function updateCharts() {
            const metric = state.activeMetric;
            const unit = METRICS[metric].unit;
            const statsA = calculateGroupStats(state.selectedIdsA, metric);
            const statsB = calculateGroupStats(state.selectedIdsB, metric);
            const combinedMax = Math.max(...statsA.vals, ...statsB.vals) * 1.1;

            const ctxSummary = getEl('chartSummary').getContext('2d');
            let valA = 0, valB = 0;
            const mode = state.summaryAggMode;
            if(mode === 'sum') { valA = statsA.sum; valB = statsB.sum; }
            else if(mode === 'avg') { valA = statsA.avg; valB = statsB.avg; }
            else if(mode === 'wAvg') { valA = statsA.wAvg; valB = statsB.wAvg; }
            else if(mode === 'median') { valA = statsA.median; valB = statsB.median; }
            else if(mode === 'max') { valA = statsA.max; valB = statsB.max; }
            else if(mode === 'min') { valA = statsA.min; valB = statsB.min; }

            if (state.charts.summary) state.charts.summary.destroy();
            state.charts.summary = new Chart(ctxSummary, {
                type: 'bar',
                data: {
                    labels: ['é›†è¨ˆçµæœ'],
                    datasets: [
                        { label: 'ã‚°ãƒ«ãƒ¼ãƒ—A', data: [valA], backgroundColor: '#2563eb', borderRadius: 12, barPercentage: 0.4 },
                        { label: 'ã‚°ãƒ«ãƒ¼ãƒ—B', data: [valB], backgroundColor: '#312e81', borderRadius: 12, barPercentage: 0.4 }
                    ]
                },
                options: {
                    responsive: true, maintainAspectRatio: false,
                    plugins: { tooltip: { callbacks: { label: (c) => ` ${c.dataset.label}: ${c.raw.toLocaleString()}${unit}` } } },
                    scales: {
                        x: { grid: { display: false }, ticks: { font: { weight: 'black' } } },
                        y: { grid: { color: '#e2e8f0', drawBorder: false }, ticks: { font: { weight: 'bold' } } }
                    }
                }
            });

            const renderDetailChart = (id, ids, color) => {
                const ctx = getEl(id).getContext('2d');
                const data = MUNICIPAL_DATA.filter(d => ids.includes(d.id)).sort((a,b) => (b[metric]||0)-(a[metric]||0));
                const labels = data.map(d => `${d.name} (${d.region.substring(0, 2)})`);
                const values = data.map(d => d[metric] || 0);
                if (state.charts[id]) state.charts[id].destroy();
                state.charts[id] = new Chart(ctx, {
                    type: 'bar',
                    data: { labels, datasets: [{ data: values, backgroundColor: color, borderRadius: 6, barPercentage: 0.6 }] },
                    options: {
                        indexAxis: 'y', responsive: true, maintainAspectRatio: false,
                        plugins: { legend: { display: false } },
                        scales: {
                            x: { max: combinedMax, grid: { display: false }, ticks: { font: { size: 9 } } },
                            y: { grid: { display: false }, ticks: { font: { weight: 'bold', size: 10 } } }
                        }
                    }
                });
            };
            renderDetailChart('chartA', state.selectedIdsA, '#2563eb');
            renderDetailChart('chartB', state.selectedIdsB, '#312e81');
        }

        window.onload = function() {
            init();
        };
    </script>
</body>
</html>